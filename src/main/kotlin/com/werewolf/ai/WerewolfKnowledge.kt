package com.werewolf.ai

import com.werewolf.model.CharacterParameters

object WerewolfKnowledge {

    val commonKnowledge = """
        ## 人狼ゲームの用語集
        - CO（カミングアウト）：自分の役職を公表すること
        - 黒・黒塗り：人狼陣営である（と疑う）こと
        - 白・白塗り：村人陣営である（と判断する）こと
        - ライン：庇い合っていると疑われるプレイヤーのつながり
        - 吊り：投票によってプレイヤーを処刑すること
        - 噛み：人狼が夜に村人を襲撃すること
    """.trimIndent()

    fun roleKnowledge(role: String): String = when (role) {
        "VILLAGER" -> """
            ## 村人の戦略
            - 発言の矛盾・不審点を探す
            - 占い師COが出たら信憑性を検証する
            - 発言が少ない・曖昧なプレイヤーを疑う
            - 誰かを庇いすぎるプレイヤーはラインの可能性がある
        """.trimIndent()

        "WEREWOLF" -> """
            ## 人狼の戦略
            - 村人のふりをして正体を隠す
            - 疑いを無実の村人へ向ける
            - 仲間の人狼を庇いすぎない（ラインがバレる）
            - 真の占い師を早期に特定して優先的に噛む
            - まれに偽占い師としてCOして場を混乱させることもある
        """.trimIndent()

        "SEER" -> """
            ## 占い師の戦略
            - 黒結果はすぐ公開して吊りに動く
            - 白結果は状況に応じて小出しにする
            - 偽占い師がCOした場合、占い結果の整合性で対抗する
            - 早期COは信頼を得やすいが噛まれるリスクも上がる
            - 【重要】占い結果が出たら、議論フェーズで必ずCOして結果を報告してください
            - 黒結果（人狼）はすぐ公開：「占い師COします。○○さんを占ったところ【黒】でした」
            - 白結果は状況次第で公開：村の混乱を防ぐために有効なタイミングで使う
            - 偽占い師がCOした場合、自分の結果の整合性を主張して対抗する
            - 早期COは信頼を得やすいが人狼に噛まれるリスクが上がる
            - 1日目の議論では必ずCOして占い結果を報告することを強く推奨します
        """.trimIndent()

        "KNIGHT" -> """
            ## 騎士の戦略
            - 原則COしない（COすると人狼に優先して噛まれる）
            - 占い師の護衛を最優先にする
            - 占い師がCOしたらすぐ護衛候補にする
        """.trimIndent()

        "MEDIUM" -> """
            ## 霊能者の戦略
            - 処刑後に結果がわかるので、翌日の昼フェーズで必ず公表する
            - 占い師と連携して人狼を追い詰める
            - 偽霊能者が出た場合は結果の整合性で対抗する
            - 人狼に狙われないよう、COのタイミングを慎重に選ぶ
            - 【重要】処刑の翌日、必ずCOして霊能結果を報告してください
            - 報告形式：「霊能者COします。昨日処刑された○○さんは【白/黒】でした」
            - 結果が黒なら人狼を処刑できた証拠として村の士気を上げる
            - 結果が白なら村が誤った処刑をしたことを伝え、次の方針を立て直す
        """.trimIndent()

        "LUNATIC" -> """
            ## 狂人の戦略
            - あなたは人狼陣営ですが、誰が人狼かは知りません
            - 村人のふりをしながら、村人陣営を混乱させる
            - 偽の占い師としてCOして偽情報を流すのが最も効果的
            - 人狼が誰かわからないため、誤って人狼を疑ってしまうこともある
        """.trimIndent()

        else -> ""
    }

    fun difficultyInstruction(level: Int): String = when (level) {
        1 -> """
            ## 推理レベル：初心者
            - 深読みはしない。表面的な発言だけで判断する
            - 他の人の意見に流されやすい
            - 重要な矛盾に気づいても見逃すことがある
        """.trimIndent()

        2 -> """
            ## 推理レベル：一般プレイヤー
            - 明らかな矛盾には気づくが、深いメタ推理はしない
            - 説得されれば考えを変える
            - たまに判断を間違える
        """.trimIndent()

        3 -> """
            ## 推理レベル：熟練プレイヤー
            - 発言の整合性・ラインを意識して推理する
            - 根拠を持って主張し、大きな矛盾はほぼ見逃さない
        """.trimIndent()

        else -> ""
    }

    fun strategyStance(params: CharacterParameters): String {
        val lines = mutableListOf<String>()
        lines += when {
            params.initiative >= 4 -> "積極的に動く。有力な情報があれば早めにCOも厭わない"
            params.initiative <= 2 -> "慎重に観察を優先。COは最終手段"
            else -> "状況を見てCOするか判断する"
        }
        lines += when {
            params.suspicion >= 4 -> "少しでも不審な点があればすぐ疑いを表明する"
            params.suspicion <= 2 -> "証拠がなければ人を疑わない"
            else -> "根拠があれば疑いを表明するが決めつけは避ける"
        }
        lines += when {
            params.adaptability >= 4 -> "読みが外れたら素直に方針転換する"
            params.adaptability <= 2 -> "一度決めた読みは簡単に変えない"
            else -> "大きな情報変化があれば方針を変える"
        }
        return "## あなたの戦略スタンス\n" +
                lines.mapIndexed { i, l -> "${i + 1}. $l" }.joinToString("\n")
    }
}
